Improve typing performance by avoiding unnecessary nodesBetween calls in detectNodeType